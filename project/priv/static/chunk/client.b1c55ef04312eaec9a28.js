"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[31],{31:(e,t,a)=>{function r(){return r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)({}).hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},r.apply(null,arguments)}a.r(t),a.d(t,{default:()=>C}),a(132);var s=a(961),o=a(540),l=a(306);a(481),a(851);var n=a(373),d=a(427),c=a(641).localhost,i=a(317),m=new function(){this.get=e=>this.req("GET",e),this.delete=e=>this.req("DELETE",e),this.post=(e,t)=>this.req("POST",e,t),this.put=(e,t)=>this.req("PUT",e,t),this.req=(e,t,a)=>new Promise((r,s)=>{var o=new i;t="undefined"!=typeof window?t:c+t,o.open(e,t),o.responseType="text",o.setRequestHeader("accept","application/json,*/*;0.8"),o.setRequestHeader("content-type","application/json"),o.onload=()=>{o.status>=200&&o.status<300?r(o.responseText&&JSON.parse(o.responseText)):s({http_code:o.status})},o.onerror=e=>{s({http_code:o.status})},o.send(a&&JSON.stringify(a))})},p=(e,t,a)=>{console.log("GoTo");var r=n.stringify(a),l=h[e].path(t)+(""==r?"":"?"+r);console.log("Changing URL to",l),history.pushState({},"",l),function(){var e=location.pathname,t=n.parse(location.search.slice(1));console.log("query string"),console.dir(t,{depth:null});var a,r=d.parse(document.cookie);for(var l in x={...x,path:e,qs:t,cookie:r},h)if(routeProps=h[l].match(e,t),routeProps){a=l,console.log("routeProps"),console.dir(routeProps,{depth:null});break}if(x={...x,...routeProps,route:a},console.log("browserState:"),console.dir(x,{depth:null}),!a)return s.render(o.createElement(k,{message:"Not Found",code:404}),document.getElementById("root"));q(x).then(e=>{x=e,console.log(x),s.render(o.createElement(v,x),document.getElementById("root"))},e=>{s.render(o.createElement(k,{message:"Shit happened",code:e.http_code}),document.getElementById("root"))})}()},u={orders:e=>{var t={...e.qs};e.qs.q&&(t.q=e.qs.q);var a=n.stringify(t);return{url:"/api/orders"+(""==a?"":"?"+a),prop:"orders"}},order:e=>({url:"/api/order/"+e.order_id,prop:"order"})},h={orders:{path:e=>"/",match:(e,t)=>"/"==e&&{handlerPath:[E,g,y]}},order:{path:e=>"/order/"+e,match:(e,t)=>{var a=new RegExp("/order/([^/]*)$").exec(e);return a&&{handlerPath:[E,g,f],order_id:a[1]}}}},v=l({displayName:"Child",render(){var[e,...t]=this.props.handlerPath;return o.createElement(e,r({},this.props,{handlerPath:t}))}}),b=function(){var e=arguments,t={};for(var a in e){var r=e[a];if(r)if("string"==typeof r||"number"==typeof r)r.split(" ").filter(e=>""!=e).map(e=>{t[e]=!0});else if("object"==typeof r)for(var s in r)t[s]=r[s]}return Object.keys(t).map(e=>t[e]&&e||"").join(" ")},E=l({displayName:"Layout",getInitialState:function(){return{modal:null,loader:null}},modal(e){this.setState({modal:{...e,callback:t=>{this.setState({modal:null},()=>{e.callback&&e.callback(t)})}}})},loader(){const e=()=>{this.setState({loader:null})};return this.setState({loader:{callback:e}}),e},render(){console.log("Rendering Layout");var e={delete:e=>o.createElement(N,e)}[this.state.modal&&this.state.modal.type];e=e&&e(this.state.modal);var t={...this.props,modal:this.modal,loader:this.loader};return o.createElement("div",{className:"root"},o.createElement("div",{className:"layout-container"},o.createElement(v,t),o.createElement("div",{className:b("modal-wrapper",{hidden:!e})},e),o.createElement("div",{className:b("loader-container",{hidden:!this.state.loader})},o.createElement("h1",null,"LOADING..."))))}}),g=l({displayName:"Header",getInitialState(){return{searchQuery:this.props.qs.q||""}},handleSearchSubmit(e){e.preventDefault();const t=new FormData(e.target).get("search")||"*:*";p("orders","",{...this.props.qs,q:t,page:0})},render(){return console.log("Start header"),o.createElement("div",{className:"header-container"},o.createElement("div",{className:"heading-div-with-search"},o.createElement("div",{className:"heading-div"},o.createElement("a",{href:"/",style:{textDecoration:"none"}},o.createElement("h1",{className:"heading"},"ORDERS")),o.createElement("div",{className:"login-block"},o.createElement("a",{href:"#",className:"button-outlined button-sign-in w-button"},"Sign In"),o.createElement("a",{href:"#",className:"button button-sign-up w-button"},"Sign Up"))),o.createElement("div",{className:"search-div"},o.createElement("form",{action:"/",className:"search w-form"},o.createElement("input",{className:"search-header w-input",maxLength:256,name:"search",placeholder:"20161698445, Jean Luc, Paris...",type:"search",id:"search",required:""}),o.createElement("input",{type:"submit",className:"search-button w-button",defaultValue:"Search"}))),o.createElement("div",{className:"search-div"},o.createElement("form",{action:"/",className:"search w-form",onSubmit:e=>this.handleSearchSubmit(e)}))),o.createElement("div",{className:"body-div"},o.createElement(v,this.props)))}}),N=l({displayName:"DeleteModal",render(){return o.createElement("div",{className:"modal-content"},o.createElement("p",null,this.props.title),o.createElement("p",null,this.props.message),o.createElement("button",{onClick:()=>{this.props.callback(!0)}},"Confirm"),o.createElement("button",{onClick:()=>{this.props.callback(!1)}},"Cancel"))}}),y=l({displayName:"Orders",statics:{remoteProps:[u.orders]},render(){return console.log("Start orders"),console.dir(this.props,{depth:null}),console.dir(this.props.orders.value,{depth:null}),o.createElement("div",{className:"body-div"},o.createElement("div",{className:"table"},o.createElement("div",{className:"table-header"},o.createElement("div",{className:"table-header-text"},"Command number"),o.createElement("div",{className:"table-header-text"},"Customer"),o.createElement("div",{className:"table-header-text"},"Address"),o.createElement("div",{className:"table-header-text"},"Quantity"),o.createElement("div",{className:"table-header-text"},"Detail"),o.createElement("div",{id:"w-node-_4011bcf9-3b62-f71c-376e-6aa385a00ed2-e5f29be1",className:"table-header-text"},"Pay"),o.createElement("div",{id:"w-node-_4a525b14-ac1e-39c2-f187-43d5a2420722-e5f29be1",className:"table-header-text"},"Actions")),o.createElement("div",{className:"table-body"},this.props.orders.value.orders.value.map(e=>{const t=e.custom,a=t.billing_address,r=t.magento.payment;return o.createElement("div",{className:"table-row",key:e.id},o.createElement("div",{className:"div-body-table"},o.createElement("div",{className:"table-body-text id"},e.remoteid)),o.createElement("div",{className:"div-body-table"},o.createElement("div",{className:"table-body-text name"},t.customer.full_name)),o.createElement("div",{className:"div-body-table"},o.createElement("div",{className:"table-body-text address"},`${a.street[0]}, \n                    ${a.city}, \n                    ${a.postcode}, \n                    ${a.country_id}`)),o.createElement("div",{className:"div-body-table"},o.createElement("div",{className:"tag-gray quantity"},t.items.length)),o.createElement("div",{className:"div-body-table"},o.createElement("a",{href:"#",className:"button-arrow button-detail w-button",in:"orders",onClick:()=>{p("order",e.id)}},"")),o.createElement("div",{className:"div-body-table"},o.createElement("a",{href:"#",className:"button-arrow button-pay w-button",in:"orders"}),o.createElement("div",{className:"div-block-6"},o.createElement("div",{className:"text-block-4"},"Status:"),o.createElement("button",{className:"tag-orange tag-status",in:"orders",onClick:()=>{console.log(`Processing payment for order ${e.id}`),m.put(`/api/order/${e.id}/payment`).then(e=>{console.log("Payment response:",e),_("orders")}).catch(e=>{console.error("Payment error:",e),alert(`Payment failed: ${e.http_code}`)})}},e.status.state?`${e.status.state} =>`:"error")),o.createElement("div",{className:"div-block-6"},o.createElement("div",{className:"text-block-4"},"Pay.method:"),o.createElement("div",{className:"tag-gray tag-delivery",in:"orders"},r.additional_information[1]))),o.createElement("a",{href:"#",className:"button-delete w-button",in:"orders",onClick:()=>{console.log("Delete order",e.id),this.props.modal({type:"delete",title:"Order deletion",message:`Are you sure you want to delete order ${e.id} ?`,callback:t=>{if(t){const t=this.props.loader();return void m.delete(`/api/order/${e.id}`).then(t=>{_("orders"),console.log(`Order ${e.id} deleted`)}).catch(e=>{alert("Deletion fails")}).finally(()=>{t()})}console.log(`Order ${e.id} deletion cancelled`)}})}},"delete"))}))),o.createElement("div",{className:"pagination-container"},o.createElement("div",{className:"pagination-div p-back"},o.createElement("a",{href:"#",className:"button-nav w-button back",onClick:()=>{console.log("Go back to orders"),this.props.qs.page&&Number(this.props.qs.page)?p("orders","",{...this.props.qs,page:Number(this.props.qs.page)-1}):console.log("No previous page")}},"")),o.createElement("div",{className:"pagination-div p-curr"},o.createElement("a",{href:"#",className:"button-nav-number w-button curr"},Number(this.props.qs.page||"0"))),o.createElement("div",{className:"pagination-div p-forward"},o.createElement("a",{href:"#",className:"button-nav w-button forward",onClick:()=>{console.log("next page"),p("orders","",{...this.props.qs,page:Number(this.props.qs.page||"0")+1})}},""))))}}),f=l({displayName:"Order",statics:{remoteProps:[u.order]},render(){console.log("Order props");const e=this.props.order.value;console.dir(e,{depth:null});const t=e.custom;return o.createElement("div",{className:"body-div"},o.createElement("div",{className:"order-props-container"},o.createElement("div",{className:"order-heading-div"},o.createElement("div",{className:"heading"},o.createElement("strong",{className:"order-props-text-darkgray"},"Order")),o.createElement("div",{className:"heading"},o.createElement("strong",{className:"order-props-text-darkgray order-id"},e.remoteid))),o.createElement("div",null,o.createElement("strong",{className:"order-props-text-darkgray"},"Propriétés")),o.createElement("div",{className:"order-header-grid"},o.createElement("div",{className:"order-props-body-div"},o.createElement("div",{className:"order-props-fa"},""),o.createElement("div",{className:"order-props-text-gray"},"Client")),o.createElement("div",{className:"order-props-body-div"},o.createElement("div",{className:"order-props-text-darkgray name"},e.custom.customer.full_name)),o.createElement("div",{className:"order-props-body-div"},o.createElement("div",{className:"order-props-fa"},""),o.createElement("div",{className:"order-props-text-gray"},"Address")),o.createElement("div",{className:"order-props-body-div"},o.createElement("div",{className:"order-props-text-darkgray address"},`${t.billing_address.street[0]}, \n          ${t.billing_address.city}, \n          ${t.billing_address.postcode}, \n          ${t.billing_address.country_id}`)),o.createElement("div",{className:"order-props-body-div"},o.createElement("div",{className:"order-props-fa"},"#"),o.createElement("div",{className:"order-props-text-gray"},"Command number")),o.createElement("div",{className:"order-props-body-div"},o.createElement("div",{className:"order-props-text-darkgray number"},e.remoteid)))),o.createElement("div",{className:"table"},o.createElement("div",{className:"order-row"},o.createElement("div",{className:"div-body-table"},o.createElement("div",{className:"table-body-text product-name"},"Pommes",o.createElement("br",null))),o.createElement("div",{id:"w-node-ae8ca97b-511a-4289-7d72-e2209ab4714f-26387994",className:"div-body-table"},o.createElement("div",{className:"tag-gray product-quantity"},"3")),o.createElement("div",{id:"w-node-d69abaa5-9570-a412-ab33-f0097c9f81f4-26387994",className:"div-body-table"},o.createElement("div",{className:"tag-gray product-price"},"1.00")),o.createElement("div",{id:"w-node-f2097018-1c8f-c06a-3620-709ab27abe1a-26387994",className:"div-body-table"},o.createElement("div",{className:"tag-gray product-total"},"3.00"))),t.items.map(e=>o.createElement("div",{className:"order-row",key:e.item_id},o.createElement("div",{className:"div-body-table"},o.createElement("div",{className:"table-body-text product-name"},e.product_title)),o.createElement("div",{id:"w-node-ae8ca97b-511a-4289-7d72-e2209ab4714f-26387994",className:"div-body-table"},o.createElement("div",{className:"tag-gray product-quantity"},e.quantity_to_fetch)),o.createElement("div",{id:"w-node-d69abaa5-9570-a412-ab33-f0097c9f81f4-26387994",className:"div-body-table"},o.createElement("div",{className:"tag-gray product-price"},e.price)),o.createElement("div",{id:"w-node-f2097018-1c8f-c06a-3620-709ab27abe1a-26387994",className:"div-body-table"},o.createElement("div",{className:"tag-gray product-total"},e.price*e.quantity_to_fetch))))),o.createElement("div",{className:"div-block-8"},o.createElement("a",{href:"#",className:"button-back w-button",onClick:()=>{console.log("Go back to orders"),history.back()}})))}}),k=l({displayName:"ErrorPage",render(){return o.createElement("h1",null,this.props.message," ",this.props.error)}}),w=l({displayName:"Link",statics:{renderFunc:null,GoTo(e,t,a){var r=h[e].path(t),s=n.stringify(a),o=r+(""==s?"":"?"+s);history.pushState({},"",o),w.onPathChange()},onPathChange(){P(location.pathname,n.parse(location.search.slice(1)),d.parse(document.cookie)).then(()=>{w.renderFunc(o.createElement(v,x))},({http_code:e})=>{w.renderFunc(o.createElement(k,{message:"Not Found",code:e}),e)})},LinkTo:(e,t,a)=>{var r=n.stringify(a);return h[e].path(t)+(""==r?"":"?"+r)}},onClick(e){e.preventDefault(),w.GoTo(this.props.to,this.props.params,this.props.query)},render(){return o.createElement("a",{href:w.LinkTo(this.props.to,this.props.params,this.props.query),onClick:this.onClick},this.props.children)}});function q(e){return new Promise((t,a)=>{console.log("Adding remote props");var r=Array.prototype.concat.apply([],e.handlerPath.map(e=>e.remoteProps).filter(e=>e));if(0==(r=r.map(t=>t(e)).filter(e=>e).filter(t=>!e[t.prop]||e[t.prop].url!=t.url)).length)return t(e);const s=(e,t)=>(e[t.prop]={url:t.url,value:t.value},e),o=r.map(e=>m.get(e.url).then(t=>(e.value=t,e)));return Promise.all(o).then(t=>t.reduce(s,e),a).then(e=>q(e).then(t,a),a)})}var x={};function P(e,t,a){var r,s;for(var o in x={...x,path:e,qs:t,Link:w,Child:v},h)if(s=h[o].match(e,t)){r=o;break}return r?q(x={...x,...s,route:r}).then(e=>{x=e}):new Promise((e,t)=>t({http_code:404}))}function _(e){console.log(`Reload remote prop ${e}`),delete x[e],q(x).then(e=>{x=e,console.log(x),s.render(o.createElement(v,x),document.getElementById("root"))},e=>{s.render(o.createElement(k,{message:"Something happened",code:e.http_code}),document.getElementById("root"))})}const C={reaxt_server_render(e,t){P(e.path,e.query,e.cookies).then(()=>{t(o.createElement(v,x))},e=>{t(o.createElement(k,{message:"Not Found :"+e.url,code:e.http_code}),e.http_code)})},reaxt_client_render(e,t){x=e,w.renderFunc=t,window.addEventListener("popstate",()=>{w.onPathChange()}),w.onPathChange()}}},132:(e,t,a)=>{a.r(t),a.d(t,{default:()=>r});const r=a.p+"index.html"}}]);
//# sourceMappingURL=client.b1c55ef04312eaec9a28.js.map