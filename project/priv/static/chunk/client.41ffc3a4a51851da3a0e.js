"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[31],{31:(e,t,a)=>{function r(){return r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)({}).hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},r.apply(null,arguments)}a.r(t),a.d(t,{default:()=>_}),a(132),a(961);var s=a(540),o=a(306);a(481),a(851);var l,n=a(373),d=a(427),c=a(641).localhost,i=a(317),m=new function(){this.get=e=>this.req("GET",e),this.delete=e=>this.req("DELETE",e),this.post=(e,t)=>this.req("POST",e,t),this.put=(e,t)=>this.req("PUT",e,t),this.req=(e,t,a)=>new Promise((r,s)=>{var o=new i;t="undefined"!=typeof window?t:c+t,o.open(e,t),o.responseType="text",o.setRequestHeader("accept","application/json,*/*;0.8"),o.setRequestHeader("content-type","application/json"),o.onload=()=>{o.status>=200&&o.status<300?r(o.responseText&&JSON.parse(o.responseText)):s({http_code:o.status})},o.onerror=e=>{s({http_code:o.status})},o.send(a&&JSON.stringify(a))})},p=(e,t,a)=>{console.log("GoTo");var r=n.stringify(a),s=u[e].path(t)+(""==r?"":"?"+r);console.log("Changing URL to",s),history.pushState({},"",s),function(){location.pathname;var e=n.parse(location.search.slice(1));console.log("query string"),console.dir(e,{depth:null}),d.parse(document.cookie)}()},h={orders:e=>{var t={...e.qs};e.qs.q&&(t.q=e.qs.q);var a=n.stringify(t);return{url:"/api/orders"+(""==a?"":"?"+a),prop:"orders"}},order:e=>({url:"/api/order/"+e.order_id,prop:"order"})},u={orders:{path:e=>"/",match:(e,t)=>"/"==e&&{handlerPath:[E,N,y]}},order:{path:e=>"/order/"+e,match:(e,t)=>{var a=new RegExp("/order/([^/]*)$").exec(e);return a&&{handlerPath:[E,N,f],order_id:a[1]}}}},v=o({displayName:"Child",render(){var[e,...t]=this.props.handlerPath;return s.createElement(e,r({},this.props,{handlerPath:t}))}}),b=function(){var e=arguments,t={};for(var a in e){var r=e[a];if(r)if("string"==typeof r||"number"==typeof r)r.split(" ").filter(e=>""!=e).map(e=>{t[e]=!0});else if("object"==typeof r)for(var s in r)t[s]=r[s]}return Object.keys(t).map(e=>t[e]&&e||"").join(" ")},E=o({displayName:"Layout",getInitialState:function(){return{modal:null,loader:null}},modal(e){this.setState({modal:{...e,callback:t=>{this.setState({modal:null},()=>{e.callback&&e.callback(t)})}}})},loader(){const e=()=>{this.setState({loader:null})};return this.setState({loader:{callback:e}}),e},render(){console.log("Rendering Layout");var e={delete:e=>s.createElement(g,e)}[this.state.modal&&this.state.modal.type];e=e&&e(this.state.modal);var t={...this.props,modal:this.modal,loader:this.loader};return s.createElement("div",{className:"root"},s.createElement("div",{className:"layout-container"},s.createElement(v,t),s.createElement("div",{className:b("modal-wrapper",{hidden:!e})},e),s.createElement("div",{className:b("loader-container",{hidden:!this.state.loader})},s.createElement("h1",null,"LOADING..."))))}}),N=o({displayName:"Header",getInitialState(){return{searchQuery:this.props.qs.q||""}},handleSearchSubmit(e){e.preventDefault();const t=new FormData(e.target).get("search")||"*:*";p("orders","",{...this.props.qs,q:t,page:0})},render(){return console.log("Start header"),s.createElement("div",{className:"header-container"},s.createElement("div",{className:"heading-div-with-search"},s.createElement("div",{className:"heading-div"},s.createElement("a",{href:"/",style:{textDecoration:"none"}},s.createElement("h1",{className:"heading"},"ORDERS")),s.createElement("div",{className:"login-block"},s.createElement("a",{href:"#",className:"button-outlined button-sign-in w-button"},"Sign In"),s.createElement("a",{href:"#",className:"button button-sign-up w-button"},"Sign Up"))),s.createElement("div",{className:"search-div"},s.createElement("form",{action:"/",className:"search w-form"},s.createElement("input",{className:"search-header w-input",maxLength:256,name:"search",placeholder:"20161698445, Jean Luc, Paris...",type:"search",id:"search",required:""}),s.createElement("input",{type:"submit",className:"search-button w-button",defaultValue:"Search"}))),s.createElement("div",{className:"search-div"},s.createElement("form",{action:"/",className:"search w-form",onSubmit:e=>this.handleSearchSubmit(e)}))),s.createElement("div",{className:"body-div"},s.createElement(v,this.props)))}}),g=o({displayName:"DeleteModal",render(){return s.createElement("div",{className:"modal-content"},s.createElement("p",null,this.props.title),s.createElement("p",null,this.props.message),s.createElement("button",{onClick:()=>{this.props.callback(!0)}},"Confirm"),s.createElement("button",{onClick:()=>{this.props.callback(!1)}},"Cancel"))}}),y=o({displayName:"Orders",statics:{remoteProps:[h.orders]},render(){return console.log("Start orders"),console.dir(this.props,{depth:null}),console.dir(this.props.orders.value,{depth:null}),s.createElement("div",{className:"body-div"},s.createElement("div",{className:"table"},s.createElement("div",{className:"table-header"},s.createElement("div",{className:"table-header-text"},"Command number"),s.createElement("div",{className:"table-header-text"},"Customer"),s.createElement("div",{className:"table-header-text"},"Address"),s.createElement("div",{className:"table-header-text"},"Quantity"),s.createElement("div",{className:"table-header-text"},"Detail"),s.createElement("div",{id:"w-node-_4011bcf9-3b62-f71c-376e-6aa385a00ed2-e5f29be1",className:"table-header-text"},"Pay"),s.createElement("div",{id:"w-node-_4a525b14-ac1e-39c2-f187-43d5a2420722-e5f29be1",className:"table-header-text"},"Actions")),s.createElement("div",{className:"table-body"},this.props.orders.value.orders.value.map(e=>{const t=e.custom,a=t.billing_address,r=t.magento.payment;return s.createElement("div",{className:"table-row",key:e.id},s.createElement("div",{className:"div-body-table"},s.createElement("div",{className:"table-body-text id"},e.remoteid)),s.createElement("div",{className:"div-body-table"},s.createElement("div",{className:"table-body-text name"},t.customer.full_name)),s.createElement("div",{className:"div-body-table"},s.createElement("div",{className:"table-body-text address"},`${a.street[0]}, \n                    ${a.city}, \n                    ${a.postcode}, \n                    ${a.country_id}`)),s.createElement("div",{className:"div-body-table"},s.createElement("div",{className:"tag-gray quantity"},t.items.length)),s.createElement("div",{className:"div-body-table"},s.createElement("a",{href:"#",className:"button-arrow button-detail w-button",in:"orders",onClick:()=>{p("order",e.id)}},"")),s.createElement("div",{className:"div-body-table"},s.createElement("a",{href:"#",className:"button-arrow button-pay w-button",in:"orders"}),s.createElement("div",{className:"div-block-6"},s.createElement("div",{className:"text-block-4"},"Status:"),s.createElement("a",{className:"tag-orange tag-status",in:"orders",onClick:()=>{console.log(`Processing payment for order ${e.id}`),this.props.loader(),m.put(`/api/order/${e.id}/payment`).then(e=>{console.log("Payment response:",e),this.props.loader(),w.GoTo("orders","",{...this.props.qs})}).catch(e=>{console.error("Payment error:",e),window.location.reload(),alert("Payment failed: you need to wait for the payment to be verified")})}},e.status.state?`${e.status.state} =>`:"error")),s.createElement("div",{className:"div-block-6"},s.createElement("div",{className:"text-block-4"},"Pay.method:"),s.createElement("div",{className:"tag-gray tag-delivery",in:"orders"},r.additional_information[1]))),s.createElement("a",{className:"button-delete w-button",in:"orders",onClick:()=>{console.log("Delete order",e.id),this.props.modal({type:"delete",title:"Order deletion",message:`Are you sure you want to delete order ${e.id} ?`,callback:t=>{t?m.delete(`/api/order/${e.id}`).then(t=>{console.log(`Order ${e.id} deleted`)}).catch(e=>{alert("Deletion fails")}).finally(()=>{console.log("Order deletion completed"),w.GoTo(orders,"",{})}):console.log(`Order ${e.id} deletion cancelled`)}})}},"delete"))}))),s.createElement("div",{className:"pagination-container"},s.createElement("div",{className:"pagination-div p-back"},s.createElement("a",{href:"#",className:"button-nav w-button back",onClick:()=>{console.log("Go back to orders"),this.props.qs.page&&Number(this.props.qs.page)?p("orders","",{...this.props.qs,page:Number(this.props.qs.page)-1}):console.log("No previous page")}},"")),s.createElement("div",{className:"pagination-div p-curr"},s.createElement("a",{href:"#",className:"button-nav-number w-button curr"},Number(this.props.qs.page||"0"))),s.createElement("div",{className:"pagination-div p-forward"},s.createElement("a",{href:"#",className:"button-nav w-button forward",onClick:()=>{console.log("next page"),p("orders","",{...this.props.qs,page:Number(this.props.qs.page||"0")+1})}},""))))}}),f=o({displayName:"Order",statics:{remoteProps:[h.order]},render(){console.log("Order props");const e=this.props.order.value;console.dir(e,{depth:null});const t=e.custom;return s.createElement("div",{className:"body-div"},s.createElement("div",{className:"order-props-container"},s.createElement("div",{className:"order-heading-div"},s.createElement("div",{className:"heading"},s.createElement("strong",{className:"order-props-text-darkgray"},"Order")),s.createElement("div",{className:"heading"},s.createElement("strong",{className:"order-props-text-darkgray order-id"},e.remoteid))),s.createElement("div",null,s.createElement("strong",{className:"order-props-text-darkgray"},"Propriétés")),s.createElement("div",{className:"order-header-grid"},s.createElement("div",{className:"order-props-body-div"},s.createElement("div",{className:"order-props-fa"},""),s.createElement("div",{className:"order-props-text-gray"},"Client")),s.createElement("div",{className:"order-props-body-div"},s.createElement("div",{className:"order-props-text-darkgray name"},e.custom.customer.full_name)),s.createElement("div",{className:"order-props-body-div"},s.createElement("div",{className:"order-props-fa"},""),s.createElement("div",{className:"order-props-text-gray"},"Address")),s.createElement("div",{className:"order-props-body-div"},s.createElement("div",{className:"order-props-text-darkgray address"},`${t.billing_address.street[0]}, \n          ${t.billing_address.city}, \n          ${t.billing_address.postcode}, \n          ${t.billing_address.country_id}`)),s.createElement("div",{className:"order-props-body-div"},s.createElement("div",{className:"order-props-fa"},"#"),s.createElement("div",{className:"order-props-text-gray"},"Command number")),s.createElement("div",{className:"order-props-body-div"},s.createElement("div",{className:"order-props-text-darkgray number"},e.remoteid)))),s.createElement("div",{className:"table"},s.createElement("div",{className:"order-row"},s.createElement("div",{className:"div-body-table"},s.createElement("div",{className:"table-body-text product-name"},"Pommes",s.createElement("br",null))),s.createElement("div",{id:"w-node-ae8ca97b-511a-4289-7d72-e2209ab4714f-26387994",className:"div-body-table"},s.createElement("div",{className:"tag-gray product-quantity"},"3")),s.createElement("div",{id:"w-node-d69abaa5-9570-a412-ab33-f0097c9f81f4-26387994",className:"div-body-table"},s.createElement("div",{className:"tag-gray product-price"},"1.00")),s.createElement("div",{id:"w-node-f2097018-1c8f-c06a-3620-709ab27abe1a-26387994",className:"div-body-table"},s.createElement("div",{className:"tag-gray product-total"},"3.00"))),t.items.map(e=>s.createElement("div",{className:"order-row",key:e.item_id},s.createElement("div",{className:"div-body-table"},s.createElement("div",{className:"table-body-text product-name"},e.product_title)),s.createElement("div",{id:"w-node-ae8ca97b-511a-4289-7d72-e2209ab4714f-26387994",className:"div-body-table"},s.createElement("div",{className:"tag-gray product-quantity"},e.quantity_to_fetch)),s.createElement("div",{id:"w-node-d69abaa5-9570-a412-ab33-f0097c9f81f4-26387994",className:"div-body-table"},s.createElement("div",{className:"tag-gray product-price"},e.price)),s.createElement("div",{id:"w-node-f2097018-1c8f-c06a-3620-709ab27abe1a-26387994",className:"div-body-table"},s.createElement("div",{className:"tag-gray product-total"},e.price*e.quantity_to_fetch))))),s.createElement("div",{className:"div-block-8"},s.createElement("a",{href:"#",className:"button-back w-button",onClick:()=>{console.log("Go back to orders"),history.back()}})))}}),k=o({displayName:"ErrorPage",render(){return s.createElement("h1",null,this.props.message," ",this.props.error)}}),w=o({displayName:"Link",statics:{renderFunc:null,GoTo(e,t,a){var r=u[e].path(t),s=n.stringify(a),o=r+(""==s?"":"?"+s);history.pushState({},"",o),w.onPathChange()},onPathChange(){x(location.pathname,n.parse(location.search.slice(1)),d.parse(document.cookie)).then(()=>{w.renderFunc(s.createElement(v,l))},({http_code:e})=>{w.renderFunc(s.createElement(k,{message:"Not Found",code:e}),e)})},LinkTo:(e,t,a)=>{var r=n.stringify(a);return u[e].path(t)+(""==r?"":"?"+r)}},onClick(e){e.preventDefault(),w.GoTo(this.props.to,this.props.params,this.props.query)},render(){return s.createElement("a",{href:w.LinkTo(this.props.to,this.props.params,this.props.query),onClick:this.onClick},this.props.children)}});function q(e){return new Promise((t,a)=>{console.log("Adding remote props");var r=Array.prototype.concat.apply([],e.handlerPath.map(e=>e.remoteProps).filter(e=>e));if(0==(r=r.map(t=>t(e)).filter(e=>e).filter(t=>!e[t.prop]||e[t.prop].url!=t.url)).length)return t(e);const s=(e,t)=>(e[t.prop]={url:t.url,value:t.value},e),o=r.map(e=>m.get(e.url).then(t=>(e.value=t,e)));return Promise.all(o).then(t=>t.reduce(s,e),a).then(e=>q(e).then(t,a),a)})}function x(e,t,a){var r,s;for(var o in l={...l,path:e,qs:t,Link:w,Child:v},u)if(s=u[o].match(e,t)){r=o;break}return r?q(l={...l,...s,route:r}).then(e=>{l=e}):new Promise((e,t)=>t({http_code:404}))}const _={reaxt_server_render(e,t){l={...l,orders:void 0,order:void 0},x(e.path,e.query,e.cookies).then(()=>{t(s.createElement(v,l))},e=>{t(s.createElement(k,{message:"Not Found :"+e.url,code:e.http_code}),e.http_code)})},reaxt_client_render(e,t){l=e,w.renderFunc=t,window.addEventListener("popstate",()=>{w.onPathChange()}),w.onPathChange()}}},132:(e,t,a)=>{a.r(t),a.d(t,{default:()=>r});const r=a.p+"index.html"}}]);
//# sourceMappingURL=client.41ffc3a4a51851da3a0e.js.map