(self.webpackChunkweb=self.webpackChunkweb||[]).push([[31],{31:(e,t,a)=>{function r(){return r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)({}).hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},r.apply(null,arguments)}a(132);var s=a(961),l=a(540),o=a(306);a(481),a(851);var n=a(373),d=a(427),c=a(317),i=new function(){this.get=e=>this.req("GET",e),this.delete=e=>this.req("DELETE",e),this.post=(e,t)=>this.req("POST",e,t),this.put=(e,t)=>this.req("PUT",e,t),this.req=(e,t,a)=>new Promise((r,s)=>{var l=new c;l.open(e,t),l.responseType="text",l.setRequestHeader("accept","application/json,*/*;0.8"),l.setRequestHeader("content-type","application/json"),l.onload=()=>{l.status>=200&&l.status<300?r(l.responseText&&JSON.parse(l.responseText)):s({http_code:l.status})},l.onerror=e=>{s({http_code:l.status})},l.send(a&&JSON.stringify(a))})},m=(e,t,a)=>{console.log("GoTo");var r=n.stringify(a),s=u[e].path(t)+(""==r?"":"?"+r);console.log("Changing URL to",s),history.pushState({},"",s),q()},p={orders:e=>{var t={...e.qs};e.qs.q&&(t.q=e.qs.q);var a=n.stringify(t);return{url:"/api/orders"+(""==a?"":"?"+a),prop:"orders"}},order:e=>({url:"/api/order/"+e.order_id,prop:"order"})},u={orders:{path:e=>"/",match:(e,t)=>"/"==e&&{handlerPath:[b,E,N]}},order:{path:e=>"/order/"+e,match:(e,t)=>{var a=new RegExp("/order/([^/]*)$").exec(e);return a&&{handlerPath:[b,E,y],order_id:a[1]}}}},v=o({displayName:"Child",render(){var[e,...t]=this.props.handlerPath;return l.createElement(e,r({},this.props,{handlerPath:t}))}}),h=function(){var e=arguments,t={};for(var a in e){var r=e[a];if(r)if("string"==typeof r||"number"==typeof r)r.split(" ").filter(e=>""!=e).map(e=>{t[e]=!0});else if("object"==typeof r)for(var s in r)t[s]=r[s]}return Object.keys(t).map(e=>t[e]&&e||"").join(" ")},b=o({displayName:"Layout",getInitialState:function(){return{modal:null,loader:null}},modal(e){this.setState({modal:{...e,callback:t=>{this.setState({modal:null},()=>{e.callback&&e.callback(t)})}}})},loader(){const e=()=>{this.setState({loader:null})};return this.setState({loader:{callback:e}}),e},render(){console.log("Rendering Layout");var e={delete:e=>l.createElement(g,e)}[this.state.modal&&this.state.modal.type];e=e&&e(this.state.modal);var t={...this.props,modal:this.modal,loader:this.loader};return l.createElement("div",{className:"root"},l.createElement("div",{className:"layout-container"},l.createElement(v,t),l.createElement("div",{className:h("modal-wrapper",{hidden:!e})},e),l.createElement("div",{className:h("loader-container",{hidden:!this.state.loader})},l.createElement("h1",null,"LOADING..."))))}}),E=o({displayName:"Header",getInitialState(){return{searchQuery:this.props.qs.q||""}},handleSearchSubmit(e){e.preventDefault();const t=new FormData(e.target).get("search")||"*:*";m("orders","",{...this.props.qs,q:t,page:0})},render(){return console.log("Start header"),l.createElement("div",{className:"header-container"},l.createElement("div",{className:"heading-div-with-search"},l.createElement("div",{className:"heading-div"},l.createElement("a",{href:"/",style:{textDecoration:"none"}},l.createElement("h1",{className:"heading"},"ORDERS")),l.createElement("div",{className:"login-block"},l.createElement("a",{href:"#",className:"button-outlined button-sign-in w-button"},"Sign In"),l.createElement("a",{href:"#",className:"button button-sign-up w-button"},"Sign Up"))),l.createElement("div",{className:"search-div"},l.createElement("form",{action:"/",className:"search w-form"},l.createElement("input",{className:"search-header w-input",maxLength:256,name:"search",placeholder:"20161698445, Jean Luc, Paris...",type:"search",id:"search",required:""}),l.createElement("input",{type:"submit",className:"search-button w-button",defaultValue:"Search"}))),l.createElement("div",{className:"search-div"},l.createElement("form",{action:"/",className:"search w-form",onSubmit:e=>this.handleSearchSubmit(e)}))),l.createElement("div",{className:"body-div"},l.createElement(v,this.props)))}}),g=o({displayName:"DeleteModal",render(){return l.createElement("div",{className:"modal-content"},l.createElement("p",null,this.props.title),l.createElement("p",null,this.props.message),l.createElement("button",{onClick:()=>{this.props.callback(!0)}},"Confirm"),l.createElement("button",{onClick:()=>{this.props.callback(!1)}},"Cancel"))}}),N=o({displayName:"Orders",statics:{remoteProps:[p.orders]},render(){return console.log("Start orders"),console.dir(this.props,{depth:null}),console.dir(this.props.orders.value,{depth:null}),l.createElement("div",{className:"body-div"},l.createElement("div",{className:"table"},l.createElement("div",{className:"table-header"},l.createElement("div",{className:"table-header-text"},"Command number"),l.createElement("div",{className:"table-header-text"},"Customer"),l.createElement("div",{className:"table-header-text"},"Address"),l.createElement("div",{className:"table-header-text"},"Quantity"),l.createElement("div",{className:"table-header-text"},"Detail"),l.createElement("div",{id:"w-node-_4011bcf9-3b62-f71c-376e-6aa385a00ed2-e5f29be1",className:"table-header-text"},"Pay"),l.createElement("div",{id:"w-node-_4a525b14-ac1e-39c2-f187-43d5a2420722-e5f29be1",className:"table-header-text"},"Actions")),l.createElement("div",{className:"table-body"},this.props.orders.value.orders.value.map(e=>{const t=e.custom,a=t.billing_address,r=t.magento.payment;return l.createElement("div",{className:"table-row",key:e.id},l.createElement("div",{className:"div-body-table"},l.createElement("div",{className:"table-body-text id"},e.remoteid)),l.createElement("div",{className:"div-body-table"},l.createElement("div",{className:"table-body-text name"},t.customer.full_name)),l.createElement("div",{className:"div-body-table"},l.createElement("div",{className:"table-body-text address"},`${a.street[0]}, \n                    ${a.city}, \n                    ${a.postcode}, \n                    ${a.country_id}`)),l.createElement("div",{className:"div-body-table"},l.createElement("div",{className:"tag-gray quantity"},t.items.length)),l.createElement("div",{className:"div-body-table"},l.createElement("a",{href:"#",className:"button-arrow button-detail w-button",in:"orders",onClick:()=>{m("order",e.id)}},"")),l.createElement("div",{className:"div-body-table"},l.createElement("a",{href:"#",className:"button-arrow button-pay w-button",in:"orders"}),l.createElement("div",{className:"div-block-6"},l.createElement("div",{className:"text-block-4"},"Status:"),l.createElement("div",{className:"tag-orange tag-status",in:"orders"},r.account_status?r.account_status:"Null")),l.createElement("div",{className:"div-block-6"},l.createElement("div",{className:"text-block-4"},"Pay.method:"),l.createElement("div",{className:"tag-gray tag-delivery",in:"orders"},r.additional_information[1]))),l.createElement("a",{href:"#",className:"button-delete w-button",in:"orders",onClick:()=>{console.log("Delete order",e.id),this.props.modal({type:"delete",title:"Order deletion",message:`Are you sure you want to delete order ${e.id} ?`,callback:t=>{if(t){const t=this.props.loader();return void i.delete(`/api/order/${e.id}`).then(t=>{var a;a="orders",console.log(`Reload remote prop ${a}`),delete k[a],w(k).then(e=>{k=e,console.log(k),s.render(l.createElement(v,k),document.getElementById("root"))},e=>{s.render(l.createElement(f,{message:"Something happened",code:e.http_code}),document.getElementById("root"))}),console.log(`Order ${e.id} deleted`)}).catch(e=>{alert("Deletion fails")}).finally(()=>{t()})}console.log(`Order ${e.id} deletion cancelled`)}})}},"delete"))}))),l.createElement("div",{className:"pagination-container"},l.createElement("div",{className:"pagination-div p-back"},l.createElement("a",{href:"#",className:"button-nav w-button back",onClick:()=>{console.log("Go back to orders"),this.props.qs.page&&Number(this.props.qs.page)?m("orders","",{...this.props.qs,page:Number(this.props.qs.page)-1}):console.log("No previous page")}},"")),l.createElement("div",{className:"pagination-div p-curr"},l.createElement("a",{href:"#",className:"button-nav-number w-button curr"},Number(this.props.qs.page||"0"))),l.createElement("div",{className:"pagination-div p-forward"},l.createElement("a",{href:"#",className:"button-nav w-button forward",onClick:()=>{console.log("next page"),m("orders","",{...this.props.qs,page:Number(this.props.qs.page||"0")+1})}},""))))}}),y=o({displayName:"Order",statics:{remoteProps:[p.order]},render(){console.log("Order props");const e=this.props.order.value;console.dir(e,{depth:null});const t=e.custom;return l.createElement("div",{className:"body-div"},l.createElement("div",{className:"order-props-container"},l.createElement("div",{className:"order-heading-div"},l.createElement("div",{className:"heading"},l.createElement("strong",{className:"order-props-text-darkgray"},"Order")),l.createElement("div",{className:"heading"},l.createElement("strong",{className:"order-props-text-darkgray order-id"},e.remoteid))),l.createElement("div",null,l.createElement("strong",{className:"order-props-text-darkgray"},"Propriétés")),l.createElement("div",{className:"order-header-grid"},l.createElement("div",{className:"order-props-body-div"},l.createElement("div",{className:"order-props-fa"},""),l.createElement("div",{className:"order-props-text-gray"},"Client")),l.createElement("div",{className:"order-props-body-div"},l.createElement("div",{className:"order-props-text-darkgray name"},e.custom.customer.full_name)),l.createElement("div",{className:"order-props-body-div"},l.createElement("div",{className:"order-props-fa"},""),l.createElement("div",{className:"order-props-text-gray"},"Address")),l.createElement("div",{className:"order-props-body-div"},l.createElement("div",{className:"order-props-text-darkgray address"},`${t.billing_address.street[0]}, \n          ${t.billing_address.city}, \n          ${t.billing_address.postcode}, \n          ${t.billing_address.country_id}`)),l.createElement("div",{className:"order-props-body-div"},l.createElement("div",{className:"order-props-fa"},"#"),l.createElement("div",{className:"order-props-text-gray"},"Command number")),l.createElement("div",{className:"order-props-body-div"},l.createElement("div",{className:"order-props-text-darkgray number"},e.remoteid)))),l.createElement("div",{className:"table"},l.createElement("div",{className:"order-row"},l.createElement("div",{className:"div-body-table"},l.createElement("div",{className:"table-body-text product-name"},"Pommes",l.createElement("br",null))),l.createElement("div",{id:"w-node-ae8ca97b-511a-4289-7d72-e2209ab4714f-26387994",className:"div-body-table"},l.createElement("div",{className:"tag-gray product-quantity"},"3")),l.createElement("div",{id:"w-node-d69abaa5-9570-a412-ab33-f0097c9f81f4-26387994",className:"div-body-table"},l.createElement("div",{className:"tag-gray product-price"},"1.00")),l.createElement("div",{id:"w-node-f2097018-1c8f-c06a-3620-709ab27abe1a-26387994",className:"div-body-table"},l.createElement("div",{className:"tag-gray product-total"},"3.00"))),t.items.map(e=>l.createElement("div",{className:"order-row",key:e.item_id},l.createElement("div",{className:"div-body-table"},l.createElement("div",{className:"table-body-text product-name"},e.product_title)),l.createElement("div",{id:"w-node-ae8ca97b-511a-4289-7d72-e2209ab4714f-26387994",className:"div-body-table"},l.createElement("div",{className:"tag-gray product-quantity"},e.quantity_to_fetch)),l.createElement("div",{id:"w-node-d69abaa5-9570-a412-ab33-f0097c9f81f4-26387994",className:"div-body-table"},l.createElement("div",{className:"tag-gray product-price"},e.price)),l.createElement("div",{id:"w-node-f2097018-1c8f-c06a-3620-709ab27abe1a-26387994",className:"div-body-table"},l.createElement("div",{className:"tag-gray product-total"},e.price*e.quantity_to_fetch))))),l.createElement("div",{className:"div-block-8"},l.createElement("a",{href:"#",className:"button-back w-button",onClick:()=>{console.log("Go back to orders"),history.back()}})))}}),f=o({displayName:"ErrorPage",render(){return l.createElement("h1",null,this.props.message," ",this.props.error)}});function w(e){return new Promise((t,a)=>{console.log("Adding remote props");var r=Array.prototype.concat.apply([],e.handlerPath.map(e=>e.remoteProps).filter(e=>e));if(0==(r=r.map(t=>t(e)).filter(e=>e).filter(t=>!e[t.prop]||e[t.prop].url!=t.url)).length)return t(e);const s=(e,t)=>(e[t.prop]={url:t.url,value:t.value},e),l=r.map(e=>i.get(e.url).then(t=>(e.value=t,e)));return Promise.all(l).then(t=>t.reduce(s,e),a).then(e=>w(e).then(t,a),a)})}var k={};function q(){var e=location.pathname,t=n.parse(location.search.slice(1));console.log("query string"),console.dir(t,{depth:null});var a,r=d.parse(document.cookie);for(var o in k={...k,path:e,qs:t,cookie:r},u)if(routeProps=u[o].match(e,t),routeProps){a=o,console.log("routeProps"),console.dir(routeProps,{depth:null});break}if(k={...k,...routeProps,route:a},console.log("browserState:"),console.dir(k,{depth:null}),!a)return s.render(l.createElement(f,{message:"Not Found",code:404}),document.getElementById("root"));w(k).then(e=>{k=e,console.log(k),s.render(l.createElement(v,k),document.getElementById("root"))},e=>{s.render(l.createElement(f,{message:"Shit happened",code:e.http_code}),document.getElementById("root"))})}window.addEventListener("popstate",()=>{q()}),q()},132:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>r});const r=a.p+"index.html"}}]);
//# sourceMappingURL=client.3cd75e6b21ba65e7a631.js.map